
# ğŸ“š 1. docker commitì™€ docker build

ë‘˜ ë‹¤ imageë¥¼ ë§Œë“œëŠ” ëª…ë ¹ì–´ì´ë‹¤.


### ğŸ“– A. docker commit

`commit` : ì‚¬ìš©í•˜ê³  ìˆëŠ” containerë¥¼ imageë¥¼ ë§Œë“œëŠ” (backupê³¼ ê°™ì€ ëŠë‚Œ)

[ìƒí™œ ì½”ë”© ê°•ì˜ ì°¸ê³ ](https://www.youtube.com/watch?v=RMNOQXs-f68)

<img width="695" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-23 á„‹á…©á„’á…® 4 41 26" src="https://user-images.githubusercontent.com/72541544/213993615-3afb8bfa-8722-496f-9b72-a5a445c50a47.png">

- docker run ì‹œí‚¬ ë•Œ ë§ˆë‹¤ containerê°€ ìƒˆë¡œ ìƒì„±ëœë‹¤.
- containerë“¤ì€ ì„œë¡œ ë…ë¦½ì ì´ë‹¤.
- containerì—ì„œ í•œ ì‘ì—…ë“¤ì€ í•´ë‹¹ containerì—ì„œë§Œ ì €ì¥ëœë‹¤.
- ìˆ˜ì •í•œ containerì—ì„œ commit ëª…ë ¹ì–´ë¥¼ ë‚´ë¦¬ë©´ ìƒˆë¡œìš´ imageê°€ ë§Œë“¤ì–´ì§„ë‹¤. (ë˜ ì´ imageë¥¼ docker run í•˜ë©´ ìƒˆë¡œìš´ containerê°€ ë§Œë“¤ì–´ì§„ë‹¤.)
- í•´ë‹¹ containerë¥¼ docker hubì— ì˜¬ë¦¬ë©´ ëˆ„êµ¬ë‚˜ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.


&nbsp;

&nbsp;


### ğŸ“– B. docker build

`build` : dockerfileì„ í†µí•´ì„œ(ê°œë°œìê°€ ì›í•˜ëŠ” ì†ì„±ì„ ì¶”ê°€í•œ í›„) í•´ë‹¹ imageë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ë“¤ë©´, ê°œë°œìê°€ ì›í•˜ëŠ” ì‹œê°„ì˜ ìˆœì„œì— ë”°ë¼ imageë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. (ìƒì„±)


<img width="798" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-23 á„‹á…©á„’á…® 5 21 37" src="https://user-images.githubusercontent.com/72541544/213993806-110e8308-2e99-4a54-926c-8b6a36c23e0d.png">

&nbsp;

**âœ”ï¸ í˜„ì¬ ë‚˜ì˜ docker imageëŠ”?**

- docker-compose.ymlì„ í†µí•´ ë§Œë“¤ì—ˆë‹¤.
- ì´í›„ ì´ imageë¥¼ í†µí•´ containerì— ì ‘ì†í•˜ì—¬ settingsí–ˆë‹¤.
- ì´ì œ containerì—ì„œ ë³€ê²½í•œ ì‘ì—…ì„ ì €ì¥í•´ì•¼ í•œë‹¤. (jar íŒŒì¼)



&nbsp;

&nbsp;



# ğŸ“š 2. docker build ì‹¤í–‰

`Dockerfile`ì„ ì‘ì„±í–ˆë‹¤ë©´, `docker build` ëª…ë ¹ì–´ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

&nbsp;

**âœ”ï¸ docker build -t, -f**

`docker build -t <ì´ë¯¸ì§€ ëª…> <Dockerfile ìœ„ì¹˜ ê²½ë¡œ>` : ì´ë¯¸ì§€ ìƒì„±

`docker build -f /home/ubuntu/docker_test/Dockerfile-Server ` : íŒŒì¼ ì´ë¦„ì´ë¦„ Dockerfileì´ ì•„ë‹Œ ê²½ìš° fë¥¼ ì‚¬ìš©í•´ íŒŒì¼ì´ë¦„ ì§€ì •


&nbsp;

**âœ”ï¸ docker containerì—ì„œ docker build ì‹¤í–‰** 

<img width="959" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-23 á„‹á…©á„’á…® 5 17 02" src="https://user-images.githubusercontent.com/72541544/213993628-cefa9cb5-df7c-463c-9867-2bda2efbb250.png">

ë‚˜ ê°™ì€ ê²½ìš° Dockerfile ìœ„ì¹˜ : `/var/jenkins_home/workspace/d208jenkins/study_docker/chuno/`


&nbsp;


**âœ”ï¸ Jenkins pipelineì—ì„œ ì‹¤í–‰ ê²°ê³¼**

<img width="1434" alt="Screenshot 2023-01-23 at 6 20 32 PM" src="https://user-images.githubusercontent.com/72541544/214004279-ab7f52d5-bbb5-40fb-9b99-35b6fd79ab1e.png">
<img width="1102" alt="Screenshot 2023-01-23 at 6 21 45 PM" src="https://user-images.githubusercontent.com/72541544/214004460-96d3d558-a5f9-44ff-8624-6948ce6af45b.png">

ì²« ì‹¤í–‰í•  ë•Œ 23ì´ˆ, ì´í›„ ë˜‘ê°™ì€ ë‚´ìš©ì¼ ê²½ìš° 4ì´ˆ, ì‹¤í–‰ ì™„ë£Œëœë‹¤.


&nbsp;

**âœ”ï¸ í˜„ì¬ê¹Œì§€ì˜ pipeline**

```shell
pipeline {
    agent any

    stages {
        stage('git clone') {
            steps {
                dir('study_docker') {
                    checkout scmGit(branches: [[name: '*/main']], extensions: [submodule(parentCredentials: true, reference: '', trackingSubmodules: true)], userRemoteConfigs: [[credentialsId: 'github-repo-user', url: 'https://github.com/ToDoStudy/study_docker']])
                }
            }
        }
        
        stage('build') {
            steps {
                dir('study_docker/chuno') {
                    sh "chmod +x gradlew"
                    sh "./gradlew clean bootJar"
                }
            }
        }
        
        stage('docker-build'){
            steps {
                script {
                    sh "docker build -t backendimage study_docker/chuno/"
                }
            }
        }
        
        
    }
}
```


&nbsp;

&nbsp;


# ğŸ“š 3. docker push 

> **ğŸ’¡ ì°¸ê³ **
> [ìƒí™œ ì½”ë”© ìˆ˜ì—…](https://www.youtube.com/watch?v=_38dU6GExDo)ì„ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.


&nbsp;

<img width="467" alt="Screenshot 2023-01-23 at 6 37 05 PM" src="https://user-images.githubusercontent.com/72541544/214009087-2f90a165-b7a6-4c94-a3ae-fc7e3171de35.png">

&nbsp;

> **ğŸ“ ì´ê²Œ ë¬´ì—‡ì´ëƒë©´?**
> `docker hub`ë¡œ ì´ë¯¸ì§€ë¥¼ ê³µìœ í•˜ëŠ” ê²ƒì´ë‹¤.


&nbsp;


**âœ”ï¸ docker hubì—ì„œ repository ë§Œë“¤ê¸°**

<img width="1419" alt="Screenshot 2023-01-23 at 6 39 40 PM" src="https://user-images.githubusercontent.com/72541544/214009090-17232499-5660-476a-8847-5aa8f5b07238.png">

<img width="1397" alt="Screenshot 2023-01-23 at 6 40 38 PM" src="https://user-images.githubusercontent.com/72541544/214009091-0949833c-5227-4958-92f3-21c57f40fb1e.png">

- `public` : ëˆ„êµ¬ë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- `private` : í˜‘ì—…í•˜ëŠ” ì‚¬ëŒë“¤ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

&nbsp;

<img width="1375" alt="Screenshot 2023-01-23 at 6 42 11 PM" src="https://user-images.githubusercontent.com/72541544/214009094-48df0b2d-a944-4653-9b03-77dbc7268f31.png">


- `imageì´ë¦„` : lkc263/d208backend
- `docker build -t (imageì´ë¦„) (ê²½ë¡œ)` : ì´ë•Œ, imageëŠ” docker hub repository imageì´ë¦„ì— ë§ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.


&nbsp;

**âœ”ï¸ í˜„ì¬ pipeline**

```shell
pipeline {
    agent any

    stages {
        stage('git clone') {
            steps {
                dir('study_docker') {
                    checkout scmGit(branches: [[name: '*/main']], extensions: [submodule(parentCredentials: true, reference: '', trackingSubmodules: true)], userRemoteConfigs: [[credentialsId: 'github-repo-user', url: 'https://github.com/ToDoStudy/study_docker']])
                }
            }
        }
        
        stage('build') {
            steps {
                dir('study_docker/chuno') {
                    sh "chmod +x gradlew"
                    sh "./gradlew clean bootJar"
                }
            }
        }
    
        stage('docker-build'){
            steps {
                script {
                    sh "docker build -t lkc263/d208backend:1.0 study_docker/chuno/"
                }
            }
        }
        
        
    }
}
```


<img width="612" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„Œá…¥á†« 12 40 25" src="https://user-images.githubusercontent.com/72541544/214082326-119a67dc-7f31-45fb-8ef6-f9c6d49e920b.png">


&nbsp;

**âœ”ï¸ docker push ì ìš©**

```shell
$ docker login : docker loginì„ í•œë‹¤.
$ docker push lkc263/d208backend:1.0 : docker hub lkc263/d208backend:1.0 repositoryì— ì €ì¥í•œë‹¤.
$ docker pull lkc263/d208backend:1.0 : docker hubì—ì„œ repositoryì„ ê°€ì ¸ì˜¨ë‹¤.
```


&nbsp;


**âœ”ï¸ í˜„ì¬ ë¬¸ì œì **

- ì´ë ‡ê²Œ í•˜ë©´ ì‹¤í–‰ ë˜ì§€ë§Œ, ë§¤ë²ˆ docker hub ë¡œê·¸ì¸ì„ í•´ì•¼í•˜ëŠ” ë‹¨ì ì´ ìˆë‹¤.
- dockerhubì— ì—°ê²°í•˜ê¸° ìœ„í•´ ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œê°€ pipelineì— ì‰½ê²Œ ë…¸ì¶œëœë‹¤.

=> ê·¸ë˜ì„œ `Credentials` (ì¸ì¦ì •ë³´)ì— docker hub ê³„ì •ì„ ë“±ë¡í•˜ë©´ ëœë‹¤. (ë“±ë¡í•  ì‹œ, pipelineì— ìƒì„±í•œ ì¸ì¦ ì •ë³´ idë§Œ ì£¼ë©´ docker hub ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì¸ì¦í•  í•„ìš”ê°€ ì—†ë‹¤.)



&nbsp;



**ğŸ”” Dockerfile ë³€ê²½ - backend**

dockerfileì´ jarì´ ì•„ë‹Œ jenkins ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ëœ ê²ƒ ê°™ì•„ ìˆ˜ì •í–ˆë‹¤.

<img width="850" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 3 55 52" src="https://user-images.githubusercontent.com/72541544/214230126-dcfd78a6-0c96-4088-981a-d0ab978177fa.png">



```text
# open jdk java11 ë²„ì „ í™˜ê²½
FROM openjdk:11-jdk

# JAR_FILE ë³€ìˆ˜ ì •ì˜
ARG JAR_FILE=./build/libs/chuno-0.0.1-SNAPSHOT.jar

# JAR íŒŒì¼ ë©”ì¸ ë””ë ‰í„°ë¦¬ì— ë³µì‚¬
COPY ${JAR_FILE} app.jar

# ì‹œìŠ¤í…œ ì§„ì…ì  ì •ì˜
ENTRYPOINT ["java", "-jar", "/app.jar"]

```


- `Dockerfile`ì€ docker buildë¥¼ í†µí•´ imageë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©ëœë‹¤.



&nbsp;



&nbsp;


### ğŸ“– A. docker hub ê³„ì • ë“±ë¡í•˜ê¸°

`Dashboard -> Jenkins ê´€ë¦¬ -> Credentials`

<img width="840" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 12 38 51" src="https://user-images.githubusercontent.com/72541544/214230717-e63538ec-30af-42e4-a13e-d9dcf0565fdb.png">

&nbsp;

<img width="1642" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 4 01 10" src="https://user-images.githubusercontent.com/72541544/214230964-d4d1d5b3-7e2b-4850-85db-34428a6068a0.png">



&nbsp;

<img width="1721" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 4 01 34" src="https://user-images.githubusercontent.com/72541544/214230966-d30a67d4-7250-4944-a138-b9aa04feca83.png">


- `kind` : Username with password
- `Username` : docker hub ê³„ì • Id (ê³µì‹ì‚¬ì´íŠ¸ ì•„ì´ë””)
- `Password` : docker hub ê³„ì • password (ê³µì‹ì‚¬ì´íŠ¸ ë¹„ë°€ë²ˆí˜¸)
- `ID` : íŒŒì´í”„ë¼ì¸ ì‘ì„± ì‹œ ì‚¬ìš©í•  ì´ë¦„ (DockerHub_IdPwd)
- `Description` : ì„¤ëª… (DockerHubIdPwd)


&nbsp;

<img width="1672" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 4 05 29" src="https://user-images.githubusercontent.com/72541544/214231389-0ba13f05-ef19-45c0-aa87-13c6d7c7cea3.png">

- í˜„ì¬ github ê³„ì •, github token, Docker hub ê³„ì •ì´ ë“±ë¡ë˜ì—ˆë‹¤.


&nbsp;

&nbsp;

### ğŸ“– B. docker build, push ì„±ê³µ!!!


**âœ”ï¸ environment**

[Jenkins ê³µì‹ ì‚¬ì´íŠ¸ environment ì„¤ëª…](https://www.jenkins.io/doc/pipeline/tour/environment/)

```shell
    environment {
        imagename = "lkc263/d208backend"
        registryCredential = 'DockerHub_IdPwd'
        dockerImage = ''
    }
```


- í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” `environment` ì„ ì‚¬ìš©í•˜ë©´ ìœ ìš©í•˜ë‹¤.
- ì „ì—­ë³€ìˆ˜ì™€ ìœ ì‚¬í•œ ê°œë…ì´ë‹¤.
- imagename : í˜„ì¬ docker hubì˜ `ì‚¬ìš©ìid/repositoryì´ë¦„`

<img width="1358" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 4 31 29" src="https://user-images.githubusercontent.com/72541544/214235259-1b864ef5-f622-450c-a237-ac5d7e7bc5a8.png">

- `registryCredential` : ì¡°ê¸ˆ ì „ credentialsì—ì„œ ë§Œë“¤ì—ˆë˜ id (docker hub ê³„ì • ì¶”ê°€í–ˆì—ˆë‹¤.)


&nbsp;

**âœ”ï¸ docker build**


```shell
         stage('docker-build'){
            steps {
                echo 'Build Docker'
                dir('study_docker/chuno'){
                    script {
                        sh "pwd"
                        dockerImage = docker.build imagename
                        
                    }
                }
            }
        }
```


- git repository ì´ë¦„ : study_docker
- chuno : backend project
- chunoì•ˆì— `Dockerfile`ì´ ì¡´ì¬í•œë‹¤.
- `dockerImage`ì— `docker.build` imagenameì„ ëŒ€ì…í–ˆë‹¤.
  - imagename : í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì¶”ê°€í–ˆë˜, docker hubì˜ `ì‚¬ìš©ìid/repositoryì´ë¦„`
  - `docker.build` => `docker build -t` : ì´ë¯¸ì§€ ìƒì„±í•œë‹¤. (ì´ë•Œ, Dockerfileì´ ì‹¤í–‰ëœë‹¤.)
  - **Dockerfile í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ imageë¥¼ ìƒì„±í•œë‹¤.**



&nbsp;

> **ğŸ’¡ ì°¸ê³ **
> `docker build -t (imageì´ë¦„) (ê²½ë¡œ)` : ì´ë•Œ, imageëŠ” docker hub repository imageì´ë¦„ì— ë§ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.


&nbsp;


**âœ”ï¸ docker push**

```shell
        stage('docker-push'){
            steps{
                echo 'Push Docker'
                script {
                    docker.withRegistry('', registryCredential){
                        dockerImage.push("1.0")
                    }
                }
                
            }
        }
```


- `docker.withRegistry('', registryCredential)` : `withRegistry`ì€ docker hub Registry ì¸ì¦ ê¶Œí•œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. 
- ì°¸ê³  ì‚¬ì´íŠ¸ : https://blog.bobbyallen.me/2020/02/24/building-testing-and-pushing-container-images-to-a-docker-registry-using-jenkins-pipelines/
- ê·¸ë¦¬ê³  docker tag ì´ë¦„ì„ ë¶™ì—¬ì¤€ë‹¤.




&nbsp;


**âœ”ï¸ í˜„ì¬ê¹Œì§€ì˜ pipeline**

```shell
pipeline {

    agent any
    
    environment {
        imagename = "lkc263/d208backend"
        registryCredential = 'DockerHub_IdPwd'
        dockerImage = ''
    }
    
    stages {
        stage('git clone') {
            steps {
                dir('study_docker') {
                    checkout scmGit(branches: [[name: '*/main']], extensions: [submodule(parentCredentials: true, reference: '', trackingSubmodules: true)], userRemoteConfigs: [[credentialsId: 'github-repo-user', url: 'https://github.com/ToDoStudy/study_docker']])
                }
            }
        }
        
        stage('build') {
            steps {
                dir('study_docker/chuno') {
                    sh "chmod +x gradlew"
                    sh "./gradlew clean bootJar"
                }
            }
        }
        
         stage('docker-build'){
            steps {
                echo 'Build Docker'
                dir('study_docker/chuno'){
                    script {
                        sh "pwd"
                        dockerImage = docker.build imagename
                        
                    }
                }
            }
        }
        
        stage('docker-push'){
            steps{
                echo 'Push Docker'
                script {
                    docker.withRegistry('', registryCredential){
                        dockerImage.push("1.0")
                    }
                }
                
            }
        }
        
    }
}
```

&nbsp;


**âœ”ï¸ ì‹¤í–‰ ê²°ê³¼**

<img width="857" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 5 16 03" src="https://user-images.githubusercontent.com/72541544/214242214-33945835-abeb-4d36-a0f8-ad0181060199.png">

<img width="1023" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 5 17 28" src="https://user-images.githubusercontent.com/72541544/214242938-447fe0df-5e25-48ac-bc54-f1fbe042d4c3.png">

<img width="1644" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 5 17 40" src="https://user-images.githubusercontent.com/72541544/214242948-0e898564-1534-4bae-8bb2-da567b874d72.png">


<img width="1697" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-24 á„‹á…©á„’á…® 5 19 37" src="https://user-images.githubusercontent.com/72541544/214242950-63f3d4ef-fad7-45ea-b6c2-406a46fbf5f7.png">


&nbsp;


&nbsp;




-----
ì°¸ê³ 
- https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9
- https://kanoos-stu.tistory.com/54

